[2049. Count Nodes With the Highest Score](https://leetcode.com/problems/count-nodes-with-the-highest-score/description/)


* Array, Tree, Binary Tree, Depth-First Search
* Amazon, Visa, DoorDash
* Similar Questions:
  * [1110. Delete Nodes And Return Forest](https://leetcode.com/problems/delete-nodes-and-return-forest)

Each node has a score. To find the score of a node, consider if the node and the edges connected to it were removed. The tree would become one or more non-empty subtrees. The **size** of a subtree is the number of the nodes in it. The **score** of the node is the product of the sizes of all those subtrees.
* The **size** of a subtree is the number of nodes in it. æ¯ä¸ªå­æ ‘çš„**å¤§å°**æ˜¯è¿™æ£µå­æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®ã€‚æ¯”å¦‚ï¼Œä»¥`2`ä¸ºèŠ‚ç‚¹çš„å­æ ‘ï¼Œsizeä¸º3ï¼Œå› ä¸ºæœ‰3ä¸ªèŠ‚ç‚¹ã€‚
* The **score** of the node is the product of the sizes of all those subtrees.
![](images/2049_Example.png)

## ğŸŸ©Method 1. From LeetCodeCN å®˜æ–¹é¢˜è§£
```java
class Solution {
    private long maxScore = 0;  // è®°å½•æœ€é«˜åˆ†
    private int cnt = 0;        // æœ€é«˜åˆ†çš„èŠ‚ç‚¹æ•°ç›®,countçš„ç¼©å†™
    private int n;              // èŠ‚ç‚¹æ•°ç›®
    List<Integer>[] children;   // æ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨

    public int countHighestScoreNodes(int[] parents) {
        n = parents.length;     // å› ä¸ºè¦ç”¨åˆ°n,æ‰€ä»¥åœ¨æ–¹æ³•å†…åˆå§‹åŒ–
        children = new List[n];
        for(int i=0; i<n; i++) {
            children[i] = new ArrayList<Integer>();
        }
        for(int i=0; i<n; i++) {
            int p = parents[i]; // éœ€è¦åˆ¤æ–­çˆ¶èŠ‚ç‚¹æ˜¯å¦æ˜¯-1
            if(p != -1) {       // å¦‚æœæ˜¯-1ï¼Œä¼šè¶…å‡ºchildrenæ•°ç»„çš„è¾¹ç•Œ
                children[p].add(i); // æ‰¾åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹
            }
        }
        dfs(0);     // æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œä»¥è¿”å›çš„æ˜¯0èŠ‚ç‚¹ä¸ºæ ¹çš„æ ‘çš„èŠ‚ç‚¹æ•°ç›®
        return cnt; // è¿”å›æœ€é«˜åˆ†çš„èŠ‚ç‚¹æ•°ç›®
    }

    // Calculate the size of subtree rooted at node
    private int dfs(int node) {
        long score = 1;
        int size = n - 1;   // sizeç”¨äºè®°å½•é™¤äº†å·¦å³å­æ ‘å’Œå½“å‰èŠ‚ç‚¹ï¼Œç¬¬ä¸‰éƒ¨åˆ†çš„èŠ‚ç‚¹æ•°ç›®
        for(int c: children[node]) {
            int t = dfs(c);
            score *= t;
            size -= t;
        }
        if(node != 0) { // `node` is not a root
            score *= size;  // å¦‚æœä¸æ˜¯æ ¹èŠ‚ç‚¹ï¼Œåˆ™è¡¨ç¤ºè¿˜æœ‰ç¬¬ä¸‰éƒ¨åˆ†ï¼Œéœ€è¦å†ä¹˜ã€‚
        }
        if(score == maxScore) {
            cnt++;
        } else if(score > maxScore) {
            maxScore = score;
            cnt = 1;
        }
        return n - size;    // ä»¥å½“å‰èŠ‚ç‚¹ä¸ºæ ¹çš„æ ‘çš„èŠ‚ç‚¹æ•°ç›®
    }
}
```
Reference: 
* https://leetcode.cn/problems/count-nodes-with-the-highest-score/solutions/1323769/tong-ji-zui-gao-fen-de-jie-dian-shu-mu-b-n810/
* https://leetcode.cn/problems/count-nodes-with-the-highest-score/solutions/1323769/tong-ji-zui-gao-fen-de-jie-dian-shu-mu-b-n810/comments/1431003


## Method 2.
```java
class Solution {
    public int countHighestScoreNodes(int[] parents) {
        int[] numOfNodes = new int[parents.length];
        List<Integer>[] children = new List[parents.length];

        for(int i=0; i<parents.length; i++) {
            children[i] = new ArrayList<>();
        }
        for(int i=1; i<parents.length; i++) {
            children[parents[i]].add(i);
        }

        findNumOfNodes(0, numOfNodes, children);

        int res = 1;
        long maxScore = 0;
        for(int i=0; i<parents.length; i++) {
            long score = 1;
            int remainingNodes = parents.length;
            for(int j: children[i]) {
                score *= numOfNodes[j];
                remainingNodes -= numOfNodes[j];
            }
            if(remainingNodes > 1) {
                score *= (remainingNodes - 1);
            }
            if(score == maxScore) {
                res++;
            } else if(score > maxScore) {
                maxScore = score;
                res = 1;
            }
        }
        return res;
    }

    private void findNumOfNodes(int k, int[] numOfNodes, List<Integer>[] children) {
        numOfNodes[k] = 1;
        for(int child: children[k]) {
            findNumOfNodes(child, numOfNodes, children);
            numOfNodes[k] += numOfNodes[child];
        }
    }
}
```
Reference:
* https://leetcode.cn/problems/count-nodes-with-the-highest-score/solutions/1323769/tong-ji-zui-gao-fen-de-jie-dian-shu-mu-b-n810/comments/1427788


## Reference
* ğŸŸ© LeetCodeCN: [ç»Ÿè®¡æœ€é«˜åˆ†çš„èŠ‚ç‚¹æ•°ç›®](https://leetcode.cn/problems/count-nodes-with-the-highest-score/solutions/1323769/tong-ji-zui-gao-fen-de-jie-dian-shu-mu-b-n810/)
* CNoodle: [[LeetCode] 2049. Count Nodes With the Highest Score](https://www.cnblogs.com/cnoodle/p/16971156.html)