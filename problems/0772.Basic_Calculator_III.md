[772. Basic Calculator III](https://leetcode.com/problems/basic-calculator-iii/)

* Amazon, Facebook, Google
* String, Stack
* Similar Questions:
    * [224. Basic Calculator](https://leetcode.com/problems/basic-calculator/)
    * [227. Basic Calculator II](https://leetcode.com/problems/basic-calculator-ii/)
    * Basic Calculator IV
    

[Java - Common template for Basic Calculator I, II, and III using Stack](https://leetcode.com/problems/basic-calculator-iii/discuss/344371/Java-Common-template-for-Basic-Calculator-I-II-and-III-using-Stack)


### æ€è·¯æ˜¯é€’å½’ + æ ˆ
1. ä¸ºä»€ä¹ˆè¦ç”¨æ ˆï¼Œæ˜¯ä¸ºäº†åœ¨é‡åˆ°ç¬¦å·çš„æ—¶å€™ï¼Œä½ è¦è®¡ç®—å±€éƒ¨ç»“æœï¼Œè¿™ä¸ªæ˜¯å’Œç‰ˆæœ¬ä¸€å’Œç‰ˆæœ¬äºŒç±»ä¼¼çš„åœ°æ–¹ï¼›
2. ä¸ºä»€ä¹ˆè¦ç”¨é€’å½’ï¼Œæ˜¯å› ä¸ºä½ ä¸çŸ¥é“åˆ°åº•æœ‰å¤šå°‘å±‚æ‹¬å·çš„åµŒå¥—ï¼Œè€Œä¸”å› ä¸ºæ‹¬å·éƒ¨åˆ†è®¡ç®—çš„ä¼˜å…ˆçº§æ˜¯æ¯”ä¹˜æ³•å’Œé™¤æ³•é«˜çš„ï¼Œå¿…é¡»å…ˆè®¡ç®—å¥½æ‹¬å·å†…çš„å†…å®¹ï¼Œæ‰èƒ½æŠŠæ‹¬å·å†…çš„å±€éƒ¨ç»“æœæ‹¿å‡ºæ¥å‚ä¸åˆ«çš„è¿ç®—ã€‚


### å¯èƒ½çš„å­—ç¬¦ç§ç±»
1. digits
2. `(` or `)`
3. âš ï¸ `+ - * /` & i=s.length()-1, é‡åˆ°è¿™äº›æƒ…å†µæ—¶ï¼Œéœ€è¦è¿›è¡Œè®¡ç®—
4. `' '`

## ğŸŸ©ğŸŒŸMethod 1. Common Template + Stack
```java
class Solution {
    public int calculate(String s) {
        if(s == null || s.length() == 0) {
            return 0;
        }
        Deque<Integer> stack = new ArrayDeque<>();
        int num = 0;        // Represent current value, like 123 in `234 + 123`
        char sign = '+';    // The initial sign for the first num, like `+` of 234
        char[] ss = s.toCharArray();
        
        for(int i=0; i<ss.length; i++) {
            if(Character.isDigit(ss[i])) {
                num = 10 * num + (ss[i] - '0');
            } else if(ss[i] == '(') {
                int cnt = 0;
                int j = i;
                for( ; i<ss.length; i++) {
                    if(ss[i] == '(') {
                        cnt++;
                    } else if(ss[i] == ')') {
                        cnt--;
                    }
                    if(cnt == 0) {
                        break;
                    }
                }   // When breaking out of this loop, ss[i]==')'
                num = calculate(s.substring(j+1, i));
            }
            // i==ss.length-1, make sure the last num is added to the stack
            if(ss[i]=='+' || ss[i]=='-' || ss[i]=='*' || ss[i]=='/' || i==ss.length-1) {
                switch(sign) {  // sign is not the current ss[i]
                    case '+':
                        stack.push(num);
                        break;
                    case '-':
                        stack.push(-num);
                        break;
                    case '*':
                        stack.push(stack.pop() * num);
                        break;
                    case '/':
                        stack.push(stack.pop() / num);
                        break;
                }
                num = 0;        // Update num and sign here
                sign = ss[i];
            }
        }
        int res = 0;
        while(!stack.isEmpty()) {
            res += stack.pop();
        }
        return res;
    }
}
```
**Complexity Analysis:**
* Time complexity: `O(n)`
  * The analysis here is simple - each character in the input can only be pushed and popped from the stack at most one time. Every other operation in each of the `O(n)` iterations costs `O(1)` - updating curr, calling evaluate, etc.
* Space complexity: O(n)
  * The stack could grow to a size of `O(n)` - for example, if the expression contains only the addition of single-digit numbers.
  

## Method 2. Iterative ? Recursive (Similar to Method 1)
```java
class Solution {
    public int calculate(String s) {
        if(s==null || s.length()==0) {
            return 0;
        }
        char[] ss = s.toCharArray();
        int len = ss.length;
        int res = 0;
        int curRes = 0;
        char sign = '+';
        int num = 0;
        int count = 0;
        
        for(int i=0; i<len; i++) {
            if(Character.isDigit(ss[i])) {
                num = 10 * num + (ss[i] - '0');
            } else if(ss[i] == '(') {
                int j = i;  // ss[i] == '('
                while(j < len) {
                    if(ss[i] == '(') {
                        count++;
                    } else if(ss[i] == ')') {
                        count--;
                    }
                    if(count == 0) {
                        break;
                    }
                    i++;
                }
                num = calculate(s.substring(j+1, i));
            }
            
            if(ss[i]=='+' || ss[i]=='-' || ss[i]=='*' || ss[i]=='/' || i==len-1) {
                switch(sign) {
                    case '+':
                        curRes += num;
                        break;
                    case '-':
                        curRes -= num;
                        break;
                    case '*':
                        curRes *= num;
                        break;
                    case '/':
                        curRes /= num;
                        break;
                }
                if(ss[i]=='+' || ss[i]=='-' || i==len-1) {
                    res += curRes;
                    curRes = 0;
                }
                sign = ss[i];
                num = 0;
            }
        }
        return res;
    }
}
```


## Method 2. Stack
```java
class Solution {
    public int calculate(String s) {
        if (s == null || s.length() == 0) {
            return 0;
        }

        Deque<Integer> stack = new ArrayDeque<>();
        int num = 0;
        char sign = '+';
        char[] cs = s.toCharArray();
        for (int i = 0; i < cs.length; i++) {
            if (Character.isDigit(cs[i])) {
                num = 10 * num + (cs[i] - '0');
            } else if (cs[i] == '(') {
                int cnt = 0;
                int j = i;
                for (; i < cs.length; i++) {
                    if (cs[i] == '(') {
                        cnt++;
                    } else if (cs[i] == ')') {
                        cnt--;
                    }
                    if (cnt == 0) {
                        break;  // break out current for-loop
                    }
                }   // after for-loop, cs[i] == ')'
                num = calculate(s.substring(j + 1, i));
            }
            if (cs[i] == '+' || cs[i] == '-' || cs[i] == '*' || cs[i] == '/' || i == cs.length - 1) {
                if (sign == '+') {
                    stack.push(num);
                } else if (sign == '-') {
                    stack.push(-num);
                } else if (sign == '*') {
                    stack.push(stack.pop() * num);
                } else if (sign == '/') {
                    stack.push(stack.pop() / num);
                }
                num = 0;
                sign = cs[i];
            }
        }

        int res = 0;
        while (!stack.isEmpty()) {
            res += stack.pop();
        }
        return res;
    }
}
```

## Reference:
1. [Java - Common template for Basic Calculator I, II, and III using Stack](https://leetcode.com/problems/basic-calculator-iii/discuss/344371/Java-Common-template-for-Basic-Calculator-I-II-and-III-using-Stack)
2. [CNoodle [LeetCode] 772. Basic Calculator III](https://www.cnblogs.com/cnoodle/p/14040192.html)
3. [Java - Common template for Basic Calculator I, II, and III using Stack](https://leetcode.com/problems/basic-calculator-iii/discuss/344371/Java-Common-template-for-Basic-Calculator-I-II-and-III-using-Stack)
